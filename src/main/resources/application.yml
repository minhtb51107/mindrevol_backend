# ===================================================================
# CẤU HÌNH CHO TÍNH NĂNG CACHE THÔNG MINH
# ===================================================================
application:
  cache:
    # ✅ Ngưỡng tương đồng cho các loại similarity/distance
    l2-distance-threshold: 0.2
    similarity-threshold: 0.95

    # ✅ L2 Redis Cache
    redis-ttl-seconds: 3600     # Thời gian sống của cache trên Redis (1 giờ)
    cleanup-interval-days: 90   # Chu kỳ dọn dẹp cache

    # ✅ L1 In-Memory Cache (Caffeine)
    l1-cache-max-size: 1000     # Số lượng mục tối đa trong cache
    l1-cache-expire-minutes: 5  # Thời gian sống của cache (phút)

# ==========================
# Datasource & Hikari Config
# ==========================
spring:
  datasource:
    hikari:
      max-lifetime: 600000   # 10 phút
      idle-timeout: 300000   # 5 phút
      connection-timeout: 30000
      connection-test-query: "SELECT 1"

  data:
    redis:
      host: localhost   # ✅ Bật lại Redis, chỉnh nếu server khác
      port: 6379
      repositories:
        enabled: true   # ✅ KÍCH HOẠT LẠI REPOSITORY

  flyway:
    repair: true

# ==========================
# App Config
# ==========================
app:
  default-pipeline-name: "default-rag"

pipelines:
  default-rag:
    steps:
      - retrieval
      - reranking
      - context-compression   # ✅ THÊM BƯỚC NÀY
      - generation
  simple-rag:
    steps:
      - retrieval
      - generation

retrieval:
  max-results: 50

# ==========================
# API Keys
# ==========================
serper:
  api:
    key: "88167f39e2136998ff9cfdb9ec1c89b781e49934"

weather:
  api:
    key: "4cc89aa50518ec1d08113963d6239d59"

fmp:
  api:
    key: "d3c257pr01qu1259be90d3c257pr01qu1259be9g"

# ==========================
# LangChain Config
# ==========================
langchain:
  retrieval:
    reranker:
      # Giảm từ 3 xuống 2 hoặc 1
      top-n: 2
